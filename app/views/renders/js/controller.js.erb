var Controller = {
  init: function () {
    View.set_initial_layout();
    Controller.activate_dom_interaction();
  },

  activate_dom_interaction: function () {
    $('html').on('click', '#open_bugs', function(){
      View.open_bugs_index();
    });

    $('html').on('click', '#open_tasks', function(){
      View.open_tasks_index();
    });

    $('html').on('click', '#tuggler_back_to_tabs', function(){
      View.set_initial_layout();
    });

    $('html').on('click', '.open_indi_bug_or_task', function(){
      var data = $(this).data();
      View.open_indi_bug_or_task(data);
    });

    $('html').on('click', '#tuggler_back_btn', function(){
      var location = Model.current_location;
      if (location == 'bug') {
        View.open_bugs_index();
      } else if (location == "task") {
        View.open_tasks_index();
      };
    });

    $('html').on('click', '#tuggler_new_Bug', function(){
      View.open_new_bug();
    });

    $('html').on('click', '#tuggler_new_Task', function(){
      View.open_new_task();
    });

    $('html').on('click', '#tuggler_submit_new_bug', function(){
      var description = $('#tuggler_input_description').val();
      var title = $('#tuggler_input_title').val();
      var user_id = Model.user_id();
      var project_id = Model.project_id();
      var route = Model.page_route();
      var params = {
        bug: {
          description: description,
          title: title
        },
        user_id: user_id,
        project_id: project_id,
        route: route
      }
      Controller.get_api("/bug/create", params, View.refresh_bug_index)
    });

    $('html').on('click', '#tuggler_submit_new_task', function(){
      debugger
      var description = $('#tuggler_input_description').val();
      var title = $('#tuggler_input_title').val();
      var user_id = Model.user_id();
      var project_id = Model.project_id();
      var route = Model.page_route();
      var params = {
        task: {
          description: description,
          title: title
        },
        user_id: user_id,
        project_id: project_id,
        route: route
      }
      Controller.get_api("/tasks/create", params, View.refresh_task_index)
    });
  },

  get_api: function (route, params, callback) {
    $.ajax({
      type: 'POST',
      url: Model.api_base + route,
      async: false,
      data: params,
      contentType: "application/json",
      dataType: 'jsonp',
      success: function(json) {
        Model.initial_page_data = json;
        callback();
      },
      error: function(e) {
        alert('something went wrong')
      }
    });
  }
};